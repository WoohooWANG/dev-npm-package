# 更新 npm 包版本

## 概述

**npm 语义化版本号规则**

npm 包版本号由主要版本、次要版本、补丁版本组成。具体如下：

| 代码状态             | 阶段               | 规则                                   | 示例  |
| -------------------- | ------------------ | -------------------------------------- | ----- |
| 第一个非正式版本发布 | 创造中             | 从 0.1.0 开始                          | 0.1.0 |
| 第一个正式版本发布   | 里程碑，且足够稳定 | 从 1.0.0 开始                          | 1.0.0 |
| 向后兼容的错误修复   | 补丁（Patch）发布  | 递增第三位数字                         | 1.0.1 |
| 向后兼容的新功能     | 次要（Minor）版本  | 递增第二位数字，并将第三位数字重置为零 | 1.1.0 |
| 破坏向后兼容性的更改 | 主要（Major）版本  | 递增第一位数字，并将其它位数字重置为零 | 2.0.0 |

**更新 npm 包版本号的两种方式：**

1. 【推荐】使用 npm version 命令更新；
1. 编辑 package.json 文件的 version 字段更新；

## 最佳实践

npm 包信息如下：

1. npm 包名称：demo-cli；
1. npm 包所属组织：tyelin-wong.com；
1. npm 包版本：0.2.0；

**获取 npm 包当前版本信息**，PowerShell 命令及输出如下：

```shell
> cd .\demo-cli\
> npm version
{
  '@tyelin-wong.com/demo-cli': '0.2.0',
  npm: '8.19.4',
  node: '16.20.2',
  v8: '9.4.146.26-node.26',
  uv: '1.43.0',
  zlib: '1.2.11',
  brotli: '1.0.9',
  ares: '1.19.1',
  modules: '93',
  nghttp2: '1.47.0',
  napi: '8',
  llhttp: '6.0.11',
  openssl: '1.1.1v+quic',
  cldr: '41.0',
  icu: '71.1',
  tz: '2022f',
  unicode: '14.0',
  ngtcp2: '0.8.1',
  nghttp3: '0.7.0'
}
```

**更新版本号**

| 目标                                                    | 示例                               | 示例版本变化             | 示例注意事项                               |
| ------------------------------------------------------- | ---------------------------------- | ------------------------ | ------------------------------------------ |
| 设置版本号                                              | npm version 1.2.3                  | 0.2.0 => 1.2.3           |                                            |
| 主要版本递增/正式化                                     | npm version major                  | 0.2.0 => 1.0.0           |                                            |
|                                                         |                                    | 1.0.0-0 => 1.0.0         | 正式化版本：当前版本为主要版本的预发布版本 |
|                                                         |                                    | 0.3.0-0 => 1.0.0         | 正式化版本：当前版本为次要版本的预发布版本 |
|                                                         |                                    | 0.2.1-0 => 1.0.0         | 正式化版本：当前版本为补丁版本的预发布版本 |
| 次要版本递增/正式化                                     | npm version minor                  | 0.2.0 => 0.3.0           |                                            |
|                                                         |                                    | 1.0.0-0 => 1.0.0         | 正式化版本：当前版本为主要版本的预发布版本 |
|                                                         |                                    | 0.3.0-0 => 0.3.0         | 正式化版本：当前版本为次要版本的预发布版本 |
|                                                         |                                    | 0.2.1-0 => 0.3.0         | 正式化版本：当前版本为补丁版本的预发布版本 |
| 补丁版本递增/正式化                                     | npm version patch                  | 0.2.0 => 0.2.1           |                                            |
|                                                         |                                    | 1.0.0-0 => 1.0.0         | 正式化版本：当前版本为主要版本的预发布版本 |
|                                                         |                                    | 0.3.0-0 => 0.3.0         | 正式化版本：当前版本为次要版本的预发布版本 |
|                                                         |                                    | 0.2.1-0 => 0.2.1         | 正式化版本：当前版本为补丁版本的预发布版本 |
| 主要版本递增，并标记为预发布版本                        | npm version premajor               | 0.2.0 => 1.0.0-0         |                                            |
| 次要版本递增，并标记为预发布版本                        | npm version preminor               | 0.2.0 => 0.3.0-0         |                                            |
| 补丁版本递增，并标记为预发布版本                        | npm version prepatch               | 0.2.0 => 0.2.1-0         |                                            |
| 主要版本递增，并标记为预览（Alpha）版本                 | npm version premajor --preid alpha | 0.2.0 => 1.0.0-alpha.0   |                                            |
| 次要版本递增，并标记为公测（Beta）版本                  | npm version preminor --preid beta  | 0.2.0 => 0.3.0-beta.0    |                                            |
| 补丁版本递增，并标记为候选（RC，Release Candidate）版本 | npm version prepatch --preid rc    | 0.2.0 => 0.2.1-rc.0      |                                            |
| 预发布版本递增                                          | npm version prerelease             | 1.0.0-rc.0 => 1.0.0-rc.1 | 非预发布版本，执行报错                     |

**注意：使用 npm version 命令会自动使用 git commit 并且打 tag，所以你要保证使用此命令时 git 缓存区为空。**

## npm 文档参考

- 关于 npm 语义化版本号规则：[About semantic versioning](https://docs.npmjs.com/about-semantic-versioning)
- npm version 命令详情：[npm-version](https://docs.npmjs.com/cli/v8/commands/npm-version)

## 其它文档参考

- 无
